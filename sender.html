<!DOCTYPE html>
<html lang="tl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sekretong Malupet üíå</title>
  <style>
    :root { --accent:#b91c1c; --muted:#6b7280; --card:#fff; --bg:#f3f4f6; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#111; display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px;}
    .card { width:100%; max-width:720px; background:var(--card); border-radius:12px; box-shadow:0 6px 24px rgba(2,6,23,0.08); padding:20px; }
    h1 { margin:0 0 6px 0; font-size:20px; }
    p.lead { margin:0 0 16px 0; color:var(--muted); font-size:14px; }
    .question { margin:12px 0; display:flex; flex-direction:column; gap:8px; }
    label { font-weight:600; font-size:14px; }
    input[type="text"], textarea, select {
      padding:10px 12px; border-radius:8px; border:1px solid #e5e7eb; font-size:14px;
    }
    textarea { min-height:90px; resize:vertical; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .btn { background:var(--accent); color:white; padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600; }
    .btn.secondary { background:#374151; }
    .small { font-size:13px; color:var(--muted); }
    .hidden { display:none; }
    .chip { background:#f8fafc; padding:8px 10px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; }
    .chip.selected { background:#fde2e2; border-color:#fca5a5; }
    .status { margin-top:12px; font-size:14px; }
    .preview { background:#f8fafc; padding:10px; border-radius:8px; border:1px dashed #e5e7eb; }
    footer { margin-top:14px; text-align:right; }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Sekretong Malupet üíå</h1>
    <p class="lead">Welcome! Sagutin nang totoo. Anonymous pwede. Bawat sagot ay ipinapadala bilang ‚Äúsekreto.‚Äù</p>

    <form id="confessForm" onsubmit="return sendConfession(event)">
      <!-- Name (optional) -->
      <div class="question">
        <label for="name">Pangalan (optional)</label>
        <input id="name" name="name" type="text" placeholder="Ilagay dito kung gusto (o iwan blank)" />
      </div>

      <!-- Q1: May nagugustuhan ka ba sa klase? -->
      <div class="question" id="q-like">
        <label>May nagugustuhan ka ba sa klase?</label>
        <div class="row">
          <button type="button" class="chip" data-value="Oo" onclick="selectOption('like','Oo', this)">Oo</button>
          <button type="button" class="chip" data-value="Wala" onclick="selectOption('like','Wala', this)">Wala</button>
        </div>
      </div>

      <!-- Q2 (if Oo): Sino dito ang nagugustuhan mo? -->
      <div class="question hidden" id="q-who">
        <label>Sino dito ang nagugustuhan mo?</label>
        <div class="row" id="choicesList">
          <!-- choices generated by JS -->
        </div>
        <div style="margin-top:8px;">
          <select id="whoSelect" class="hidden"></select>
        </div>
      </div>

      <!-- Q2b (if Iba pa) -->
      <div class="question hidden" id="q-who-other">
        <label>Kung iba, sino? (ipasok ang pangalan)</label>
        <input id="whoOther" type="text" placeholder="I-type ang pangalan (eg. Maria)" />
      </div>

      <!-- Q3: Kung sakaling may mag-confess sayo... -->
      <div class="question" id="q-confess">
        <label>Kung sakaling may mag-confess sayo sa kaklase mo, tatanggapin mo ba depende sa ugali?</label>
        <div class="row">
          <button type="button" class="chip" onclick="selectOption('acceptDepends','Oo')">Oo</button>
          <button type="button" class="chip" onclick="selectOption('acceptDepends','Depende sa tao')">Depende sa tao</button>
          <button type="button" class="chip" onclick="selectOption('acceptDepends','Wala akong balak magmahal')">Wala akong balak</button>
        </div>
      </div>

      <!-- Q4: Ready ka na bang magmahal ulit? -->
      <div class="question" id="q-ready">
        <label>Ready ka na bang magmahal ulit?</label>
        <div class="row">
          <button type="button" class="chip" onclick="selectOption('ready','Oo')">Oo</button>
          <button type="button" class="chip" onclick="selectOption('ready','Hindi pa')">Hindi pa</button>
          <button type="button" class="chip" onclick="selectOption('ready','Di ko sure')">Di ko sure</button>
        </div>
      </div>

      <!-- Q5: Interested ka ba sa relationship ngayon? -->
      <div class="question" id="q-interested">
        <label>Interested ka ba sa relationship ngayon?</label>
        <div class="row">
          <button type="button" class="chip" onclick="selectOption('interested','Oo')">Oo</button>
          <button type="button" class="chip" onclick="selectOption('interested','Hindi muna')">Hindi muna</button>
          <button type="button" class="chip" onclick="selectOption('interested','Siguro kung siya')">Siguro kung siya</button>
        </div>
      </div>

      <!-- Q6: Sa mga tropa mo, may nagugustuhan ka ba? -->
      <div class="question" id="q-tropa">
        <label>Sa mga tropa mo, may nagugustuhan ka ba?</label>
        <div class="row">
          <button type="button" class="chip" onclick="selectOption('tropa','Oo')">Oo</button>
          <button type="button" class="chip" onclick="selectOption('tropa','Wala')">Wala</button>
        </div>
      </div>

      <!-- Q7 (if tropa Oo): Sino sa tropa mo? -->
      <div class="question hidden" id="q-tropa-who">
        <label>Sino sa tropa mo 'yon?</label>
        <input id="tropaWho" type="text" placeholder="Ilagay pangalan ng tropa (o group)" />
      </div>

      <!-- Q8: Anong gusto mong sabihin sa taong gusto mo? -->
      <div class="question" id="q-message">
        <label>Anong gusto mong sabihin sa taong gusto mo (pwede hugot o kwento)?</label>
        <textarea id="msg" placeholder="Type mo dito ang iyong secret message..."></textarea>
        <div class="small">Hindi mandatory ‚Äî pero panghugot ito, so go lang. üòâ</div>
      </div>

      <!-- Q9: Kung bibigyan ka ng chance na ligawan mo siya... -->
      <div class="question" id="q-pursue">
        <label>Kung bibigyan ka ng chance na ligawan mo siya, gagawin mo ba?</label>
        <div class="row">
          <button type="button" class="chip" onclick="selectOption('pursue','Oo')">Oo</button>
          <button type="button" class="chip" onclick="selectOption('pursue','Hindi')">Hindi</button>
          <button type="button" class="chip" onclick="selectOption('pursue','Siguro kung single siya')">Siguro kung single siya</button>
        </div>
      </div>

      <!-- Hidden inputs to hold choices -->
      <input type="hidden" id="val_like" name="val_like" />
      <input type="hidden" id="val_who" name="val_who" />
      <input type="hidden" id="val_acceptDepends" name="val_acceptDepends" />
      <input type="hidden" id="val_ready" name="val_ready" />
      <input type="hidden" id="val_interested" name="val_interested" />
      <input type="hidden" id="val_tropa" name="val_tropa" />
      <input type="hidden" id="val_tropaWho" name="val_tropaWho" />
      <input type="hidden" id="val_pursue" name="val_pursue" />

      <div style="margin-top:12px;">
        <div class="preview small" id="preview">Preview: wala pang sagot.</div>
      </div>

      <footer>
        <button type="button" class="btn secondary" onclick="resetForm()">I-reset</button>
        <button type="submit" class="btn" id="sendBtn">Ipadala ang Sekreto üíå</button>
      </footer>

      <div class="status" id="status"></div>
    </form>
  </div>

  <script>
    /*******************************
     * CONFIG - Palitan kung kailangan
     *******************************/
    const DATABASE_ENDPOINT = "https://confession-receiver-default-rtdb.firebaseio.com/replies.json";
    // NOTE: Keep the path 'replies' dahil doon nagbabasa ang admin page.

    // Predefined classmate choices
    const CLASSMATES = ["Yuri", "Jithro", "Deniega", "Nev", "Segio", "Iba pa"];

    /*******************************
     * UI init
     *******************************/
    function initChoices() {
      const container = document.getElementById("choicesList");
      container.innerHTML = "";
      CLASSMATES.forEach(name => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip";
        btn.textContent = name;
        btn.onclick = () => {
          if (name === "Iba pa") {
            // show other input
            selectOption('who', 'Iba pa', btn);
            document.getElementById('q-who-other').classList.remove('hidden');
            document.getElementById('whoOther').focus();
          } else {
            selectOption('who', name, btn);
            document.getElementById('q-who-other').classList.add('hidden');
          }
        };
        container.appendChild(btn);
      });
    }
    initChoices();

    // helper to mark selected chips and set hidden input
    function selectOption(key, value, element) {
      // toggle visuals for chips inside same question container
      // find all chips within same container
      const containerMap = {
        like: document.getElementById('q-like'),
        who: document.getElementById('q-who'),
        acceptDepends: document.getElementById('q-confess'),
        ready: document.getElementById('q-ready'),
        interested: document.getElementById('q-interested'),
        tropa: document.getElementById('q-tropa'),
        pursue: document.getElementById('q-pursue')
      };
      const container = containerMap[key];
      if (container) {
        const chips = container.querySelectorAll('.chip');
        chips.forEach(c => c.classList.remove('selected'));
        if (element) element.classList.add('selected');
      }

      // set hidden inputs & toggles
      document.getElementById('val_' + (key === 'who' ? 'who' : key)).value = value;

      // conditional show/hide logic
      if (key === 'like') {
        if (value === 'Oo') {
          document.getElementById('q-who').classList.remove('hidden');
          document.getElementById('q-who-other').classList.add('hidden');
        } else {
          document.getElementById('q-who').classList.add('hidden');
          document.getElementById('q-who-other').classList.add('hidden');
          // set who empty
          document.getElementById('val_who').value = "";
        }
      }

      if (key === 'tropa') {
        if (value === 'Oo') {
          document.getElementById('q-tropa-who').classList.remove('hidden');
        } else {
          document.getElementById('q-tropa-who').classList.add('hidden');
          document.getElementById('tropaWho').value = '';
          document.getElementById('val_tropaWho').value = '';
        }
      }

      updatePreview();
    }

    // update preview text
    function updatePreview() {
      const name = (document.getElementById('name').value || 'Anonymous').trim();
      const like = document.getElementById('val_like').value || 'Wala';
      const who = (document.getElementById('val_who').value === 'Iba pa') ? (document.getElementById('whoOther').value || 'Iba pa') : (document.getElementById('val_who').value || '');
      const acceptDepends = document.getElementById('val_acceptDepends').value || '';
      const ready = document.getElementById('val_ready').value || '';
      const interested = document.getElementById('val_interested').value || '';
      const tropa = document.getElementById('val_tropa').value || '';
      const tropaWho = document.getElementById('tropaWho').value || '';
      const pursue = document.getElementById('val_pursue').value || '';
      const msg = document.getElementById('msg').value || '';

      let lines = [];
      lines.push(`From: ${name}`);
      lines.push(`May nagugustuhan sa klase?: ${like}`);
      if (like === 'Oo') lines.push(`Sino?: ${who}`);
      lines.push(`Tatanggapin ba kung mag-confess (depende sa ugali)?: ${acceptDepends}`);
      lines.push(`Ready ka na bang magmahal ulit?: ${ready}`);
      lines.push(`Interested sa relationship ngayon?: ${interested}`);
      lines.push(`Sa tropa may nagugustuhan?: ${tropa}`);
      if (tropa === 'Oo') lines.push(`Sino sa tropa?: ${tropaWho}`);
      lines.push(`Kung bibigyan ng chance, ligawan mo ba?: ${pursue}`);
      if (msg) lines.push(`Message: ${msg}`);

      document.getElementById('preview').textContent = "Preview:\n" + lines.join('\n');
    }

    // keep preview in sync with typing
    ['name','whoOther','msg','tropaWho'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('input', () => {
        if (id === 'whoOther') {
          document.getElementById('val_who').value = document.getElementById('whoOther').value.trim() ? 'Iba pa' : document.getElementById('val_who').value;
        }
        if (id === 'tropaWho') {
          document.getElementById('val_tropaWho').value = el.value;
        }
        updatePreview();
      });
    });

    // also update preview when hidden inputs change (for safety)
    document.querySelectorAll('input[type=hidden]').forEach(h => h.addEventListener('change', updatePreview));

    // reset
    function resetForm() {
      document.getElementById('confessForm').reset();
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
      document.getElementById('q-who').classList.add('hidden');
      document.getElementById('q-who-other').classList.add('hidden');
      document.getElementById('q-tropa-who').classList.add('hidden');
      // clear hidden vals
      ['val_like','val_who','val_acceptDepends','val_ready','val_interested','val_tropa','val_tropaWho','val_pursue'].forEach(id => {
        const el = document.getElementById(id); if (el) el.value = '';
      });
      updatePreview();
      document.getElementById('status').textContent = '';
      window.scrollTo({top:0, behavior:'smooth'});
    }

    /*******************************
     * Send to Firebase (REST POST)
     *******************************/
    async function sendConfession(e) {
      e.preventDefault();
      const sendBtn = document.getElementById('sendBtn');
      const statusEl = document.getElementById('status');

      // gather values
      const payload = {
        name: (document.getElementById('name').value || 'Anonymous').trim(),
        like_in_class: document.getElementById('val_like').value || 'Wala',
        who_in_class: (document.getElementById('val_who').value === 'Iba pa' ? (document.getElementById('whoOther').value || 'Iba pa') : document.getElementById('val_who').value) || '',
        accept_confess: document.getElementById('val_acceptDepends').value || '',
        ready_to_love: document.getElementById('val_ready').value || '',
        interested_relationship: document.getElementById('val_interested').value || '',
        tropa_like: document.getElementById('val_tropa').value || 'Wala',
        tropa_who: document.getElementById('tropaWho').value || '',
        pursue_if_chance: document.getElementById('val_pursue').value || '',
        secret_message: document.getElementById('msg').value || '',
        timestamp: Date.now()
      };

      // basic validation (at least something)
      if (!payload.secret_message && payload.like_in_class === 'Wala' && payload.tropa_like === 'Wala') {
        if (!confirm('Wala kang nilagay na message at sinabing wala ring gustong tao ‚Äî gusto mo pa rin ipadala?')) {
          return;
        }
      }

      try {
        sendBtn.disabled = true;
        sendBtn.textContent = 'Pinapadala...';
        statusEl.textContent = '';

        const res = await fetch(DATABASE_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          throw new Error('Network error: ' + res.status);
        }

        // success
        sendBtn.textContent = 'Ipadala ang Sekreto üíå';
        sendBtn.disabled = false;
        statusEl.innerHTML = '<span style="color:green; font-weight:600;">‚úÖ Sekretong naipadala! Salamat sa pagiging totoo üòâ</span>';
        // reset form for next
        resetForm();
      } catch (err) {
        console.error(err);
        statusEl.innerHTML = '<span style="color:#a43838; font-weight:600;">‚ö†Ô∏è Error sa pagpapadala. Check ang network o Firebase rules.</span>';
        sendBtn.disabled = false;
        sendBtn.textContent = 'Ipadala ang Sekreto üíå';
      }
    }

    // init preview
    updatePreview();
  </script>
</body>
</html>
